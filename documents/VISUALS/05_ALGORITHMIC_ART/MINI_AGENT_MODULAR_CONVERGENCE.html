<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini-Agent System - Modular Convergence</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Lora:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --anthropic-dark: #141413;
            --anthropic-light: #faf9f5;
            --anthropic-mid-gray: #b0aea5;
            --anthropic-light-gray: #e8e6dc;
            --anthropic-orange: #d97757;
            --anthropic-blue: #6a9bcc;
            --anthropic-green: #788c5d;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--anthropic-light) 0%, #f5f3ee 100%);
            min-height: 100vh;
            color: var(--anthropic-dark);
        }
        .container { display: flex; min-height: 100vh; padding: 20px; gap: 20px; }
        .sidebar {
            width: 320px; flex-shrink: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 24px; border-radius: 12px;
            box-shadow: 0 10px 30px rgba(20, 20, 19, 0.1);
            overflow-y: auto;
        }
        .sidebar h1 { font-family: 'Lora', serif; font-size: 22px; font-weight: 500; margin-bottom: 4px; }
        .sidebar .subtitle { color: var(--anthropic-mid-gray); font-size: 13px; margin-bottom: 28px; line-height: 1.4; }
        .control-section { margin-bottom: 28px; }
        .control-section h3 { font-size: 14px; font-weight: 600; margin-bottom: 14px; display: flex; align-items: center; gap: 8px; }
        .control-section h3::before { content: '•'; color: var(--anthropic-orange); font-weight: bold; }
        .seed-input {
            width: 100%; background: var(--anthropic-light);
            padding: 10px; border-radius: 8px;
            font-family: 'Courier New', monospace; font-size: 14px;
            margin-bottom: 10px; border: 1px solid var(--anthropic-light-gray);
            text-align: center;
        }
        .seed-input:focus { outline: none; border-color: var(--anthropic-orange); background: white; }
        .seed-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; }
        .control-group { margin-bottom: 16px; }
        .control-group label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; }
        .slider-container { display: flex; align-items: center; gap: 10px; }
        .slider-container input[type="range"] {
            flex: 1; height: 4px; background: var(--anthropic-light-gray);
            border-radius: 2px; outline: none; -webkit-appearance: none;
        }
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 14px; height: 14px;
            background: var(--anthropic-orange); border-radius: 50%; cursor: pointer;
        }
        .value-display { font-family: 'Courier New', monospace; font-size: 11px; color: var(--anthropic-mid-gray); min-width: 50px; text-align: right; }
        .button {
            background: var(--anthropic-orange); color: white; border: none;
            padding: 9px 14px; border-radius: 6px; font-size: 13px;
            font-weight: 500; cursor: pointer; transition: all 0.2s ease; width: 100%;
        }
        .button:hover { background: #c86641; transform: translateY(-1px); }
        .button.secondary { background: var(--anthropic-blue); }
        .button.secondary:hover { background: #5a8bb8; }
        .button.tertiary { background: var(--anthropic-green); }
        .button.tertiary:hover { background: #6b7b52; }
        .button-row { display: flex; gap: 8px; }
        .button-row .button { flex: 1; }
        .canvas-area { flex: 1; display: flex; align-items: center; justify-content: center; }
        #canvas-container {
            width: 100%; max-width: 900px; border-radius: 12px;
            overflow: hidden; box-shadow: 0 20px 40px rgba(20, 20, 19, 0.1); background: white;
        }
        #canvas-container canvas { display: block; width: 100% !important; height: auto !important; }
        .legend { margin-top: 20px; font-size: 11px; color: var(--anthropic-mid-gray); }
        .legend-item { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .legend-dot { width: 10px; height: 10px; border-radius: 50%; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>Modular Convergence</h1>
            <div class="subtitle">Mini-Agent System Architecture<br>Visualized through force-directed dynamics</div>

            <div class="control-section">
                <h3>Seed</h3>
                <input type="number" id="seed-input" class="seed-input" value="42" onchange="updateSeed()">
                <div class="seed-controls">
                    <button class="button secondary" onclick="previousSeed()">← Prev</button>
                    <button class="button secondary" onclick="nextSeed()">Next →</button>
                </div>
                <button class="button tertiary" onclick="randomSeedAndUpdate()">↻ Random</button>
            </div>

            <div class="control-section">
                <h3>Parameters</h3>
                <div class="control-group">
                    <label>Repulsion Force</label>
                    <div class="slider-container">
                        <input type="range" id="repulsion" min="50" max="500" step="10" value="200" oninput="updateParam('repulsion', this.value)">
                        <span class="value-display" id="repulsion-value">200</span>
                    </div>
                </div>
                <div class="control-group">
                    <label>Connection Strength</label>
                    <div class="slider-container">
                        <input type="range" id="connectionStrength" min="0.01" max="0.2" step="0.01" value="0.08" oninput="updateParam('connectionStrength', this.value)">
                        <span class="value-display" id="connectionStrength-value">0.08</span>
                    </div>
                </div>
                <div class="control-group">
                    <label>Damping</label>
                    <div class="slider-container">
                        <input type="range" id="damping" min="0.8" max="0.99" step="0.01" value="0.92" oninput="updateParam('damping', this.value)">
                        <span class="value-display" id="damping-value">0.92</span>
                    </div>
                </div>
                <div class="control-group">
                    <label>Node Size</label>
                    <div class="slider-container">
                        <input type="range" id="nodeSize" min="8" max="40" step="2" value="22" oninput="updateParam('nodeSize', this.value)">
                        <span class="value-display" id="nodeSize-value">22</span>
                    </div>
                </div>
            </div>

            <div class="control-section">
                <h3>Actions</h3>
                <div class="button-row">
                    <button class="button" onclick="resetParameters()">Reset</button>
                    <button class="button secondary" onclick="saveCanvas('mini_agent_art')">Save PNG</button>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item"><div class="legend-dot" style="background: #4F46E5;"></div>Infrastructure (Config, Utils)</div>
                <div class="legend-item"><div class="legend-dot" style="background: #14B8A6;"></div>LLM Providers (OpenAI, MiniMax, Z.AI)</div>
                <div class="legend-item"><div class="legend-dot" style="background: #8B5CF6;"></div>External Tools (Web, File, Git)</div>
                <div class="legend-item"><div class="legend-dot" style="background: #10B981;"></div>Skills (PDF, DOCX, Canvas, etc.)</div>
                <div class="legend-item"><div class="legend-dot" style="background: #FB923C;"></div>User Interface (CLI, VS Code, API)</div>
            </div>
        </div>

        <div class="canvas-area">
            <div id="canvas-container"></div>
        </div>
    </div>

    <script>
        let params = {
            seed: 42,
            repulsion: 200,
            connectionStrength: 0.08,
            damping: 0.92,
            nodeSize: 22
        };
        let defaultParams = {...params};
        let nodes = [];
        let edges = [];

        // Mini-Agent system components
        const systemComponents = [
            // Infrastructure (indigo)
            { name: 'Config', type: 'infrastructure', color: '#4F46E5' },
            { name: 'Utils', type: 'infrastructure', color: '#4F46E5' },
            { name: 'Credit\nProtection', type: 'infrastructure', color: '#4F46E5' },
            
            // LLM Providers (teal)
            { name: 'OpenAI', type: 'llm', color: '#14B8A6' },
            { name: 'MiniMax\nGLM', type: 'llm', color: '#14B8A6' },
            { name: 'Z.AI', type: 'llm', color: '#14B8A6' },
            
            // Tools (violet)
            { name: 'Web\nSearch', type: 'tool', color: '#8B5CF6' },
            { name: 'Web\nReader', type: 'tool', color: '#8B5CF6' },
            { name: 'File\nOps', type: 'tool', color: '#8B5CF6' },
            { name: 'Git', type: 'tool', color: '#8B5CF6' },
            
            // Skills (green)
            { name: 'PDF', type: 'skill', color: '#10B981' },
            { name: 'DOCX', type: 'skill', color: '#10B981' },
            { name: 'PPTX', type: 'skill', color: '#10B981' },
            { name: 'XLSX', type: 'skill', color: '#10B981' },
            { name: 'Canvas\nDesign', type: 'skill', color: '#10B981' },
            { name: 'Algo\nArt', type: 'skill', color: '#10B981' },
            { name: 'MCP\nBuilder', type: 'skill', color: '#10B981' },
            { name: 'Fact\nCheck', type: 'skill', color: '#10B981' },
            
            // User Interface (amber)
            { name: 'CLI', type: 'ui', color: '#FB923C' },
            { name: 'VS Code', type: 'ui', color: '#FB923C' },
            { name: 'Python\nAPI', type: 'ui', color: '#FB923C' }
        ];

        // System connections (relationships)
        const systemConnections = [
            // Infrastructure connects to LLM
            ['Config', 'OpenAI'], ['Config', 'MiniMax\nGLM'], ['Config', 'Z.AI'],
            ['Utils', 'OpenAI'], ['Utils', 'MiniMax\nGLM'], ['Utils', 'Z.AI'],
            ['Credit\nProtection', 'Z.AI'],
            
            // LLM connects to Skills
            ['OpenAI', 'PDF'], ['OpenAI', 'DOCX'], ['OpenAI', 'PPTX'], ['OpenAI', 'XLSX'],
            ['MiniMax\nGLM', 'Canvas\nDesign'], ['MiniMax\nGLM', 'Algo\nArt'],
            ['Z.AI', 'MCP\nBuilder'], ['Z.AI', 'Fact\nCheck'],
            
            // Tools connect to Skills
            ['Web\nSearch', 'Fact\nCheck'], ['Web\nReader', 'Fact\nCheck'],
            ['File\nOps', 'PDF'], ['File\nOps', 'DOCX'], ['File\nOps', 'PPTX'], ['File\nOps', 'XLSX'],
            ['Git', 'MCP\nBuilder'],
            
            // UI connects to Skills
            ['CLI', 'PDF'], ['CLI', 'Canvas\nDesign'], ['CLI', 'Algo\nArt'],
            ['VS Code', 'MCP\nBuilder'], ['VS Code', 'DOCX'],
            ['Python\nAPI', 'XLSX'], ['Python\nAPI', 'Fact\nCheck'],
            
            // Tool interconnections
            ['Web\nSearch', 'Web\nReader'],
            
            // Skill clusters
            ['PDF', 'DOCX'], ['DOCX', 'PPTX'], ['PPTX', 'XLSX'],
            ['Canvas\nDesign', 'Algo\nArt']
        ];

        class Node {
            constructor(comp, x, y) {
                this.name = comp.name;
                this.type = comp.type;
                this.color = comp.color;
                this.x = x;
                this.y = y;
                this.vx = 0;
                this.vy = 0;
                this.radius = params.nodeSize;
            }

            applyForce(fx, fy) {
                this.vx += fx;
                this.vy += fy;
            }

            update() {
                this.vx *= params.damping;
                this.vy *= params.damping;
                this.x += this.vx;
                this.y += this.vy;
                
                // Boundary constraints with padding
                let pad = 60;
                if (this.x < pad) { this.x = pad; this.vx *= -0.5; }
                if (this.x > width - pad) { this.x = width - pad; this.vx *= -0.5; }
                if (this.y < pad) { this.y = pad; this.vy *= -0.5; }
                if (this.y > height - pad) { this.y = height - pad; this.vy *= -0.5; }
            }

            draw() {
                // Glow effect
                noStroke();
                let c = color(this.color);
                for (let i = 3; i > 0; i--) {
                    c.setAlpha(30);
                    fill(c);
                    ellipse(this.x, this.y, params.nodeSize + i * 8);
                }
                
                // Main node
                c.setAlpha(255);
                fill(c);
                stroke(255);
                strokeWeight(2);
                ellipse(this.x, this.y, params.nodeSize);
                
                // Label
                noStroke();
                fill(60);
                textAlign(CENTER, CENTER);
                textSize(8);
                text(this.name, this.x, this.y + params.nodeSize / 2 + 12);
            }
        }

        function setup() {
            let canvas = createCanvas(900, 900);
            canvas.parent('canvas-container');
            textFont('Poppins');
            initializeSystem();
        }

        function initializeSystem() {
            randomSeed(params.seed);
            noiseSeed(params.seed);
            nodes = [];
            edges = [];

            // Create nodes with random positions clustered by type
            let centerX = width / 2;
            let centerY = height / 2;
            
            systemComponents.forEach((comp, i) => {
                let angle = random(TWO_PI);
                let radius = 150 + random(150);
                let x = centerX + cos(angle) * radius;
                let y = centerY + sin(angle) * radius;
                nodes.push(new Node(comp, x, y));
            });

            // Create edges from connections
            systemConnections.forEach(conn => {
                let source = nodes.find(n => n.name === conn[0]);
                let target = nodes.find(n => n.name === conn[1]);
                if (source && target) {
                    edges.push({ source, target });
                }
            });
        }

        function draw() {
            background(250, 249, 245);
            
            // Title watermark
            fill(200);
            noStroke();
            textSize(14);
            textAlign(CENTER);
            text('Mini-Agent System Architecture', width/2, 30);
            
            // Apply forces
            for (let i = 0; i < nodes.length; i++) {
                for (let j = i + 1; j < nodes.length; j++) {
                    let dx = nodes[j].x - nodes[i].x;
                    let dy = nodes[j].y - nodes[i].y;
                    let dist = max(1, sqrt(dx * dx + dy * dy));
                    
                    // Repulsion force (inverse square)
                    let force = params.repulsion / (dist * dist);
                    let fx = (dx / dist) * force;
                    let fy = (dy / dist) * force;
                    
                    nodes[i].applyForce(-fx, -fy);
                    nodes[j].applyForce(fx, fy);
                }
            }

            // Attraction along edges
            edges.forEach(edge => {
                let dx = edge.target.x - edge.source.x;
                let dy = edge.target.y - edge.source.y;
                let dist = sqrt(dx * dx + dy * dy);
                
                let force = (dist - 100) * params.connectionStrength;
                let fx = (dx / dist) * force;
                let fy = (dy / dist) * force;
                
                edge.source.applyForce(fx, fy);
                edge.target.applyForce(-fx, -fy);
            });

            // Center gravity
            nodes.forEach(node => {
                let dx = width/2 - node.x;
                let dy = height/2 - node.y;
                node.applyForce(dx * 0.0005, dy * 0.0005);
            });

            // Draw edges
            edges.forEach(edge => {
                let c1 = color(edge.source.color);
                let c2 = color(edge.target.color);
                c1.setAlpha(60);
                c2.setAlpha(60);
                
                // Curved connection
                strokeWeight(1.5);
                noFill();
                
                let mx = (edge.source.x + edge.target.x) / 2;
                let my = (edge.source.y + edge.target.y) / 2;
                let dx = edge.target.x - edge.source.x;
                let dy = edge.target.y - edge.source.y;
                let offset = 20;
                
                stroke(lerpColor(c1, c2, 0.5));
                beginShape();
                vertex(edge.source.x, edge.source.y);
                quadraticVertex(mx - dy * 0.1, my + dx * 0.1, edge.target.x, edge.target.y);
                endShape();
            });

            // Update and draw nodes
            nodes.forEach(node => {
                node.update();
                node.radius = params.nodeSize;
                node.draw();
            });
            
            // Seed display
            fill(180);
            textSize(10);
            textAlign(RIGHT);
            text('seed: ' + params.seed, width - 20, height - 20);
        }

        // UI Functions
        function updateParam(name, value) {
            params[name] = parseFloat(value);
            document.getElementById(name + '-value').textContent = value;
        }

        function updateSeed() {
            let input = document.getElementById('seed-input');
            params.seed = parseInt(input.value) || 1;
            initializeSystem();
        }

        function previousSeed() {
            params.seed = Math.max(1, params.seed - 1);
            document.getElementById('seed-input').value = params.seed;
            initializeSystem();
        }

        function nextSeed() {
            params.seed++;
            document.getElementById('seed-input').value = params.seed;
            initializeSystem();
        }

        function randomSeedAndUpdate() {
            params.seed = Math.floor(Math.random() * 99999) + 1;
            document.getElementById('seed-input').value = params.seed;
            initializeSystem();
        }

        function resetParameters() {
            params = {...defaultParams};
            document.getElementById('seed-input').value = params.seed;
            document.getElementById('repulsion').value = params.repulsion;
            document.getElementById('repulsion-value').textContent = params.repulsion;
            document.getElementById('connectionStrength').value = params.connectionStrength;
            document.getElementById('connectionStrength-value').textContent = params.connectionStrength;
            document.getElementById('damping').value = params.damping;
            document.getElementById('damping-value').textContent = params.damping;
            document.getElementById('nodeSize').value = params.nodeSize;
            document.getElementById('nodeSize-value').textContent = params.nodeSize;
            initializeSystem();
        }
    </script>
</body>
</html>
